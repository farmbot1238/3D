<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>عارض مجسم GLB</title>
  <!-- model-viewer (يدعم ملفات GLB/GLTF ويعمل بدون إعداد معقد) -->
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <style>
    :root{ --bg:#0b1020; --card:#0f1724; --accent:#4f46e5; --text:#e6eef8; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,Segoe UI,Arial; background:linear-gradient(180deg,var(--bg),#081023);color:var(--text);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px}
    .wrap{width:100%;max-width:1100px;background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);border-radius:14px;padding:18px;box-shadow:0 10px 30px rgba(2,6,23,0.6)}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:12px}
    h1{font-size:18px;margin:0}
    .controls{display:flex;gap:8px;align-items:center}
    button,input[type=file],label{background:var(--card);border:1px solid rgba(255,255,255,0.04);color:var(--text);padding:8px 10px;border-radius:8px;cursor:pointer}
    input[type=file]{padding:6px}
    .viewer-wrap{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));border-radius:10px;padding:8px}
    model-viewer{width:100%;height:620px;border-radius:8px;background:linear-gradient(180deg,#081225,#071021);display:block}
    .footer{display:flex;gap:10px;align-items:center;margin-top:10px;justify-content:space-between}
    .info{opacity:0.9;font-size:13px}
    .small{font-size:12px;opacity:0.8}
    @media(max-width:768px){model-viewer{height:450px}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>عارض مجسم ثلاثي الأبعاد — GLB</h1>
      <div class="controls">
        <!-- زر لاختيار ملف محلي -->
        <label for="fileInput">تحميل ملف GLB</label>
        <input id="fileInput" type="file" accept=".glb,.gltf" />
        <button id="toggleAuto">إيقاف الدوران</button>
      </div>
    </header>

    <div class="viewer-wrap">
      <!-- استبدل قيمة src بمسار مجسم GLB خاصتك أو استخدم اختيار الملف أعلاه -->
      <model-viewer id="mv"
        src="https://modelviewer.dev/shared-assets/models/Astronaut.glb"
        alt="مجسم ثلاثي الأبعاد"
        exposure="1"
        auto-rotate
        camera-controls
        ar
        shadow-intensity="1"
        interaction-policy="allow-when-focused"
        style="outline:none">
      </model-viewer>
    </div>

    <div class="footer">
      <div class="info small">سحب + تكبير/تصغير بالماوس — اسحب لتدوير، عجلة الماوس للتقريب</div>
      <div class="small">ملاحظة: يمكنك استبدال الـ <code>src</code> بمسار ملف GLB أو تحميل ملف محلي.</div>
    </div>
  </div>

  <script>
    const fileInput = document.getElementById('fileInput');
    const mv = document.getElementById('mv');
    const toggleAuto = document.getElementById('toggleAuto');

    // عند اختيار ملف محلي نستخدم URL.createObjectURL لعرضه
    fileInput.addEventListener('change', (e)=>{
      const f = e.target.files && e.target.files[0];
      if(!f) return;
      // تحقق سريع من امتداد الملف
      const name = f.name.toLowerCase();
      if(!name.endsWith('.glb') && !name.endsWith('.gltf')){
        alert('الرجاء اختيار ملف بصيغة .glb أو .gltf');
        return;
      }
      const url = URL.createObjectURL(f);
      mv.src = url;
      // تحرير الكائن عند تحميل النموذج لمنع تسرب الذاكرة
      mv.addEventListener('load', ()=>{
        try{ URL.revokeObjectURL(url); }catch(e){}
      }, { once:true });
    });

    // تبديل التشغيل التلقائي للدوران
    toggleAuto.addEventListener('click', ()=>{
      if(mv.hasAttribute('auto-rotate')){
        mv.removeAttribute('auto-rotate');
        toggleAuto.textContent = 'تشغيل الدوران';
      } else {
        mv.setAttribute('auto-rotate','');
        toggleAuto.textContent = 'إيقاف الدوران';
      }
    });

    // دعم السحب لوضع مجسم من رابط (اختياري)
    // يمكنك سحب رابط ملف glb من المتصفح وإفلاته هنا
    const wrap = document.querySelector('.viewer-wrap');
    ['dragenter','dragover'].forEach(evt=>wrap.addEventListener(evt,e=>{e.preventDefault(); e.dataTransfer.dropEffect='copy';}));
    wrap.addEventListener('drop', e=>{
      e.preventDefault();
      const file = e.dataTransfer.files && e.dataTransfer.files[0];
      if(file){
        if(!file.name.toLowerCase().match(/\.gltf?$|\.glb$/)) return alert('الملف ليس GLB/Gltf');
        const u = URL.createObjectURL(file);
        mv.src = u;
        mv.addEventListener('load', ()=>{ try{ URL.revokeObjectURL(u);}catch(e){} }, { once:true });
        return;
      }
      // في حال كان ما تم إسقاطه رابطًا
      const url = e.dataTransfer.getData('text/uri-list') || e.dataTransfer.getData('text/plain');
      if(url && (url.endsWith('.glb')||url.endsWith('.gltf'))){ mv.src = url; }
    });

  </script>
</body>
</html>
